---
- hosts: webstream-test
  sudo: yes
  tasks:
    # OS
    - name: install libselinux-python
      yum: name=libselinux-python state=latest
    - name: set yum repository
      yum: name={{item}}
      with_items:
        - https://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm
        - http://rpms.famillecollet.com/enterprise/remi-release-6.rpm
    # Apache
    - name: install apache
      yum: name=httpd state=latest
    - name: start apache and enabled
      service: name=httpd state=started enabled=yes
    - name: change owner
      file: dest=/var/www/html owner=vagrant recurse=yes
    # PHP
    - name: install php
      yum: pkg={{item}} state=latest enablerepo=remi,remi-php56
      with_items:
        - php
        - php-devel
        - php-mbstring
        - php-mysql
      notify:
       - restart apache
    - name: show phpinfo
      copy: src=./vm/webstream-test/phpinfo.php dest=/var/www/html owner=vagrant
    # MySQL
    - name: install mysql
      yum: name={{item}} state=latest
      with_items:
        - mysql-server
        - MySQL-python
    - name: start mysql and enabled
      service: name=mysqld state=started enabled=yes
    - name: create database
      mysql_db: name=sandbox state=present
    - name: create user
      mysql_user: name=mysql password=mysql priv=mysql.*:ALL state=present
  handlers:
    - name: restart apache
      service: name=httpd state=restarted